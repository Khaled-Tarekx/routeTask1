<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: controllers.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: controllers.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import Application from './models';
import Company from '../companies/models';
import Job from '../jobs/models';
import {validateDates} from './helpers';
import ExcelJS from 'exceljs';
import fileType from 'file-type';
import cloudinary from '../../cloudinary/setup.js';

/**
 * Applies to a job.
 *
 * @param {Object} req - The request object.
 * @param {Object} res - The response object.
 * @returns {Promise&lt;void>}
 */
export const applyToJob = asyncHandler(async (req, res) => {
	const userResume = req.file;
	const {jobId, userId, userTechSkills, userSoftSkills} = req.body;

	if (!userResume) {
		return res.status(400).json('No file uploaded');
	}
	const fileTypeResult = await fileType.fileTypeFromBlob(userResume);
	if (!fileTypeResult &amp;&amp; fileTypeResult.mime !== 'application/pdf') {
		return res.status(400).json('Invalid file type, only PDF is allowed');
	}
	cloudinary.uploader.upload(userResume, async (err, result) => {
		if (err) {
			return res.status(400).json(err);
		}

		const application = await Application.create({
			jobId,
			userId,
			userTechSkills,
			userSoftSkills,
			userResume: result.secure_url,
		});
		res.status(200).json('job created successfully', application);
	});
});

/**
 * Stores applications for a company.
 *
 * @param {Object} req - The request object.
 * @param {Object} res - The response object.
 * @returns {Promise&lt;void>}
 */
export const storeApplicationsForCompany = asyncHandler(async (req, res) => {
	const {id} = req.user;
	const {companyId} = req.params;
	const {startDate, endDate} = req.query;
	validateDates(startDate, endDate);
	const company = await Company.findById(companyId);
	if (!company) {
		return res.status(404).json('Company not found');
	}

	if (!(await isResourceOwner(id, company.companyHR))) {
		res.status(400).json('you are not the user owner');
	}
	const jobs = await Job.find({addedBy: company.companyHR});
	if (jobs.length === 0) {
		return res.status(404).json({message: 'No jobs found for this company'});
	}

	for (const job of jobs) {
		const lookUpQuery = {jobId: job.id};

		if (startDate &amp;&amp; endDate) {
			lookUpQuery.createdAt = {
				$gte: new Date(startDate),
				$lte: new Date(endDate),
			};
		}
		const applications = await Application.find(lookUpQuery)
			.populate('userId', 'username email')
			.populate('jobId');
	}
	const workBook = new ExcelJS.Workbook();
	const workSheet = workBook.addWorksheet('Application');
	workSheet.columns = [
		{header: 'Job Title', key: 'jobTitle', width: 25},
		{header: 'Job Location', key: 'jobLocation', width: 20},
		{header: 'Seniority Level', key: 'seniorityLevel', width: 20},
		{header: 'User Name', key: 'username', width: 20},
		{header: 'User Email', key: 'email', width: 30},
		{header: 'Application Date', key: 'createdAt', width: 25},
		{header: 'Application Date', key: 'createdAt', width: 25},
		{header: 'Application Date', key: 'createdAt', width: 25},
		{header: 'Application Date', key: 'createdAt', width: 25},
	];
});
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#applyToJob">applyToJob</a></li><li><a href="global.html#storeApplicationsForCompany">storeApplicationsForCompany</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 4.0.3</a> on Mon Aug 12 2024 11:34:33 GMT+0300 (Eastern European Summer Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
